{"ast":null,"code":"var _jsxFileName = \"/home/hmny/Projects/M-and-M/client/src/Editor/App.js\";\nimport React, { useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { makeStyles, Typography, Box, Button, Fab } from '@material-ui/core';\nimport { Add as AddIcon, Home as HomeIcon } from '@material-ui/icons';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess';\nimport shortid from 'shortid';\nimport { useEditor } from './context/EditorContext';\nimport Preview from '../common/Preview';\nimport GraphCanvas from './components/GraphCanvas';\nimport Inspector from './components/Inspector';\nimport TemplatesDialog from './components/TemplatesDialog';\nimport Panel from './components/Panel';\nimport SaveButton from '../common/SaveButton';\nimport * as ROUTES from '../routes';\nimport CompSettings from './constants/ComponentProperties.json';\nconst useStyles = makeStyles(theme => ({\n  container: {\n    position: 'relative',\n    maxWidth: '100vw',\n    height: '100vh',\n    overflow: 'hidden',\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: '#3d3d3d'\n  },\n  buttonsContainer: {\n    position: 'absolute',\n    top: theme.spacing(2),\n    left: theme.spacing(2),\n    display: 'flex',\n    flexDirection: 'row',\n    zIndex: 1\n  },\n  addButton: {\n    marginRight: theme.spacing(2)\n  },\n  addIcon: {\n    marginRight: theme.spacing(1)\n  },\n  saveButton: {},\n  saveIcon: {\n    marginRight: theme.spacing(1)\n  },\n  homeButton: {\n    marginRight: theme.spacing(2)\n  },\n  preview: {\n    marginLeft: theme.spacing(2),\n    height: '100%',\n    display: 'flex',\n    alignItems: 'end',\n    '& > *': {\n      marginBottom: theme.spacing(7)\n    }\n  },\n  caption: {\n    position: 'absolute',\n    bottom: 0,\n    left: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    width: '100%',\n    zIndex: 5 // keep it above graph but under ispector\n\n  },\n  innerCaption: {\n    opacity: '0.75',\n    backgroundColor: '#616161',\n    borderRadius: 4,\n    textAlign: 'center',\n    padding: 15,\n    paddingTop: 0\n  },\n  graphStyle: {\n    position: 'relative',\n    '& .vis-network': {\n      width: '100%',\n      height: '100vh',\n      outline: 'none'\n    }\n  }\n}));\n\nconst appendNodeId = (nodeId, components) => components.map(component => {\n  let updatedComponent;\n\n  if (component.answers !== undefined) {\n    const answers = component.answers.map(answer => {\n      return { ...answer,\n        id: `${nodeId}-${answer.id}`\n      };\n    });\n    updatedComponent = { ...component,\n      id: `${nodeId}-${component.id}`,\n      answers: answers\n    };\n\n    if (updatedComponent.children) {\n      updatedComponent.children = appendNodeId(nodeId, component.children);\n    }\n  } else {\n    updatedComponent = { ...component,\n      id: `${nodeId}-${component.id}`\n    };\n\n    if (updatedComponent.children) {\n      updatedComponent.children = appendNodeId(nodeId, component.children);\n    }\n  }\n\n  return updatedComponent;\n});\n\nconst App = () => {\n  const classes = useStyles();\n  const history = useHistory();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isCaptionOpen, setIsCaptionOpen] = useState(true);\n  const {\n    story,\n    workingActivity,\n    saveStory,\n    setPathToValue\n  } = useEditor();\n  const currentNode = story.nodes.find(node => node.id === workingActivity);\n\n  const setNodeDestinations = (components, dest, specificPath) => {\n    // Setup the node to point to itself onAdd\n    const destinationFrags = ['SelectFragment', 'AnswerFragment', 'AnswerFragmentImages'];\n    const buttonFrags = destinationFrags[0];\n    const choiceFrags = destinationFrags.slice(-2);\n    components.forEach((comp, index) => {\n      const basepath = [...(specificPath || ['components']), index];\n      const option = CompSettings[comp.name].find(({\n        fragment\n      }) => destinationFrags.includes(fragment));\n\n      if (option) {\n        if (buttonFrags.includes(option.fragment)) {\n          // Button case, simply set the story.nextNode object to itself\n          const {\n            pathAlternative,\n            valToChange\n          } = option.props;\n          setPathToValue([...basepath, ...(pathAlternative || [])], valToChange, dest, dest);\n        } else if (choiceFrags.includes(option.fragment)) {\n          // MultiAnsChoice and similar case, is needed to set the whole\n          // destinaion object one level before in the object itself\n          const {\n            selectPath\n          } = option.props;\n          const dummy = {\n            '[CORRECT]': dest,\n            '[WRONG]': dest\n          };\n          const pathToVal = [...basepath, ...selectPath.slice(0, -1)];\n          const valToChange = selectPath.slice(-1);\n          setPathToValue(pathToVal, valToChange, dummy, dest);\n        }\n      } // Recursive call on children\n\n\n      if (comp.children) setNodeDestinations(comp.children, dest, [...basepath, 'children']);\n    });\n  };\n\n  const addNode = template => {\n    setIsDialogOpen(false);\n    const {\n      nodes,\n      ...others\n    } = story;\n    const nodeId = shortid.generate();\n    const components = appendNodeId(nodeId, template.components); //saveStory({ nodes: [...nodes, { id: nodeId, ...template, components }], ...others });\n\n    nodes.push({\n      id: nodeId,\n      ...template,\n      components\n    });\n    saveStory({\n      nodes: [...nodes],\n      ...others\n    });\n    setNodeDestinations(components, nodeId);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.graphStyle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.buttonsContainer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Fab, {\n    className: classes.homeButton,\n    onClick: () => history.push(ROUTES.HOME),\n    size: \"medium\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(HomeIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Fab, {\n    variant: \"extended\",\n    className: classes.addButton,\n    onClick: () => setIsDialogOpen(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(AddIcon, {\n    className: classes.addIcon,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }\n  }), \"Add Node\"), /*#__PURE__*/React.createElement(SaveButton, {\n    story: story,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Box, {\n    className: classes.caption,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 9\n    }\n  }, !isCaptionOpen ? /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setIsCaptionOpen(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(ExpandLessIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 15\n    }\n  })) : /*#__PURE__*/React.createElement(Box, {\n    className: classes.innerCaption,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setIsCaptionOpen(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ExpandMoreIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Typography, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 15\n    }\n  }, \"Clicca 2 volte su un nodo per modificarlo\"), /*#__PURE__*/React.createElement(Typography, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 15\n    }\n  }, \"Trascina un nodo per spostarlo\"), /*#__PURE__*/React.createElement(Typography, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 15\n    }\n  }, \"Per eliminare un nodo vai in Global - Delete node\"))), /*#__PURE__*/React.createElement(Panel, {\n    open: currentNode != null,\n    position: \"left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.preview,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Preview, {\n    components: currentNode ? currentNode.components : [],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(GraphCanvas, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Panel, {\n    open: currentNode != null,\n    position: \"right\",\n    style: {\n      top: 0\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Inspector, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(TemplatesDialog, {\n    open: isDialogOpen,\n    onCancel: () => setIsDialogOpen(false),\n    onConfirm: addNode,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default App;","map":{"version":3,"sources":["/home/hmny/Projects/M-and-M/client/src/Editor/App.js"],"names":["React","useState","useHistory","makeStyles","Typography","Box","Button","Fab","Add","AddIcon","Home","HomeIcon","ExpandMoreIcon","ExpandLessIcon","shortid","useEditor","Preview","GraphCanvas","Inspector","TemplatesDialog","Panel","SaveButton","ROUTES","CompSettings","useStyles","theme","container","position","maxWidth","height","overflow","display","flexDirection","backgroundColor","buttonsContainer","top","spacing","left","zIndex","addButton","marginRight","addIcon","saveButton","saveIcon","homeButton","preview","marginLeft","alignItems","marginBottom","caption","bottom","justifyContent","width","innerCaption","opacity","borderRadius","textAlign","padding","paddingTop","graphStyle","outline","appendNodeId","nodeId","components","map","component","updatedComponent","answers","undefined","answer","id","children","App","classes","history","isDialogOpen","setIsDialogOpen","isCaptionOpen","setIsCaptionOpen","story","workingActivity","saveStory","setPathToValue","currentNode","nodes","find","node","setNodeDestinations","dest","specificPath","destinationFrags","buttonFrags","choiceFrags","slice","forEach","comp","index","basepath","option","name","fragment","includes","pathAlternative","valToChange","props","selectPath","dummy","pathToVal","addNode","template","others","generate","push","HOME"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { makeStyles, Typography, Box, Button, Fab } from '@material-ui/core';\nimport { Add as AddIcon, Home as HomeIcon } from '@material-ui/icons';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess';\nimport shortid from 'shortid';\n\nimport { useEditor } from './context/EditorContext';\nimport Preview from '../common/Preview';\nimport GraphCanvas from './components/GraphCanvas';\nimport Inspector from './components/Inspector';\nimport TemplatesDialog from './components/TemplatesDialog';\nimport Panel from './components/Panel';\nimport SaveButton from '../common/SaveButton';\n\nimport * as ROUTES from '../routes';\nimport CompSettings from './constants/ComponentProperties.json';\n\nconst useStyles = makeStyles(theme => ({\n  container: {\n    position: 'relative',\n    maxWidth: '100vw',\n    height: '100vh',\n    overflow: 'hidden',\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: '#3d3d3d',\n  },\n  buttonsContainer: {\n    position: 'absolute',\n    top: theme.spacing(2),\n    left: theme.spacing(2),\n    display: 'flex',\n    flexDirection: 'row',\n    zIndex: 1,\n  },\n  addButton: {\n    marginRight: theme.spacing(2),\n  },\n  addIcon: {\n    marginRight: theme.spacing(1),\n  },\n  saveButton: {},\n  saveIcon: {\n    marginRight: theme.spacing(1),\n  },\n  homeButton: {\n    marginRight: theme.spacing(2),\n  },\n  preview: {\n    marginLeft: theme.spacing(2),\n    height: '100%',\n    display: 'flex',\n    alignItems: 'end',\n    '& > *': {\n      marginBottom: theme.spacing(7),\n    },\n  },\n  caption: {\n    position: 'absolute',\n    bottom: 0,\n    left: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    width: '100%',\n    zIndex: 5, // keep it above graph but under ispector\n  },\n  innerCaption: {\n    opacity: '0.75',\n    backgroundColor: '#616161',\n    borderRadius: 4,\n    textAlign: 'center',\n    padding: 15,\n    paddingTop: 0,\n  },\n  graphStyle: {\n    position: 'relative',\n    '& .vis-network': {\n      width: '100%',\n      height: '100vh',\n      outline: 'none',\n    },\n  },\n}));\n\nconst appendNodeId = (nodeId, components) =>\n  components.map(component => {\n    let updatedComponent;\n    if (component.answers !== undefined) {\n      const answers = component.answers.map(answer => {\n        return { ...answer, id: `${nodeId}-${answer.id}` };\n      });\n      updatedComponent = {\n        ...component,\n        id: `${nodeId}-${component.id}`,\n        answers: answers,\n      };\n      if (updatedComponent.children) {\n        updatedComponent.children = appendNodeId(nodeId, component.children);\n      }\n    } else {\n      updatedComponent = { ...component, id: `${nodeId}-${component.id}` };\n      if (updatedComponent.children) {\n        updatedComponent.children = appendNodeId(nodeId, component.children);\n      }\n    }\n    return updatedComponent;\n  });\n\nconst App = () => {\n  const classes = useStyles();\n  const history = useHistory();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isCaptionOpen, setIsCaptionOpen] = useState(true);\n  const { story, workingActivity, saveStory, setPathToValue } = useEditor();\n\n  const currentNode = story.nodes.find(node => node.id === workingActivity);\n\n  const setNodeDestinations = (components, dest, specificPath) => {\n    // Setup the node to point to itself onAdd\n    const destinationFrags = ['SelectFragment', 'AnswerFragment', 'AnswerFragmentImages'];\n    const buttonFrags = destinationFrags[0];\n    const choiceFrags = destinationFrags.slice(-2);\n\n    components.forEach((comp, index) => {\n      const basepath = [...(specificPath || ['components']), index];\n\n      const option = CompSettings[comp.name].find(({ fragment }) =>\n        destinationFrags.includes(fragment)\n      );\n\n      if (option) {\n        if (buttonFrags.includes(option.fragment)) {\n          // Button case, simply set the story.nextNode object to itself\n          const { pathAlternative, valToChange } = option.props;\n          setPathToValue(\n            [...basepath, ...(pathAlternative || [])],\n            valToChange,\n            dest,\n            dest\n          );\n        } else if (choiceFrags.includes(option.fragment)) {\n          // MultiAnsChoice and similar case, is needed to set the whole\n          // destinaion object one level before in the object itself\n          const { selectPath } = option.props;\n          const dummy = { '[CORRECT]': dest, '[WRONG]': dest };\n          const pathToVal = [...basepath, ...selectPath.slice(0, -1)];\n          const valToChange = selectPath.slice(-1);\n          setPathToValue(pathToVal, valToChange, dummy, dest);\n        }\n      }\n      // Recursive call on children\n      if (comp.children)\n        setNodeDestinations(comp.children, dest, [...basepath, 'children']);\n    });\n  };\n\n  const addNode = template => {\n    setIsDialogOpen(false);\n    const { nodes, ...others } = story;\n    const nodeId = shortid.generate();\n    const components = appendNodeId(nodeId, template.components);\n    //saveStory({ nodes: [...nodes, { id: nodeId, ...template, components }], ...others });\n    nodes.push({ id: nodeId, ...template, components });\n    saveStory({ nodes: [...nodes], ...others });\n    setNodeDestinations(components, nodeId);\n  };\n\n  return (\n    <div className={classes.container}>\n      <div className={classes.graphStyle}>\n        <div className={classes.buttonsContainer}>\n          <Fab\n            className={classes.homeButton}\n            onClick={() => history.push(ROUTES.HOME)}\n            size=\"medium\"\n          >\n            <HomeIcon />\n          </Fab>\n          <Fab\n            variant=\"extended\"\n            className={classes.addButton}\n            onClick={() => setIsDialogOpen(true)}\n          >\n            <AddIcon className={classes.addIcon} />\n            Add Node\n          </Fab>\n          <SaveButton story={story} />\n        </div>\n        <Box className={classes.caption}>\n          {!isCaptionOpen ? (\n            <Button onClick={() => setIsCaptionOpen(true)}>\n              <ExpandLessIcon />\n            </Button>\n          ) : (\n            <Box className={classes.innerCaption}>\n              <Button onClick={() => setIsCaptionOpen(false)}>\n                <ExpandMoreIcon />\n              </Button>\n              <Typography>Clicca 2 volte su un nodo per modificarlo</Typography>\n              <Typography>Trascina un nodo per spostarlo</Typography>\n              <Typography>Per eliminare un nodo vai in Global - Delete node</Typography>\n            </Box>\n          )}\n        </Box>\n\n        <Panel open={currentNode != null} position=\"left\">\n          <div className={classes.preview}>\n            <Preview components={currentNode ? currentNode.components : []} />\n          </div>\n        </Panel>\n        <GraphCanvas />\n        <Panel open={currentNode != null} position=\"right\" style={{ top: 0 }}>\n          <Inspector />\n        </Panel>\n        <TemplatesDialog\n          open={isDialogOpen}\n          onCancel={() => setIsDialogOpen(false)}\n          onConfirm={addNode}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}