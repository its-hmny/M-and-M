{"ast":null,"code":"var _jsxFileName = \"/home/hmny/Projects/M-and-M/client/src/Publisher/index.js\";\nimport React, { useEffect, useState } from 'react';\nimport { makeStyles, List, ListItem, ListItemText, ListItemSecondaryAction, IconButton, Divider, Fab, Tooltip } from '@material-ui/core';\nimport { Add as AddIcon, Edit as EditIcon, Delete as DeleteIcon, FileCopy as FileCopyIcon, Assessment as AssessmentIcon } from '@material-ui/icons';\nimport { Link } from 'react-router-dom';\nimport AreYouSureDialog from './AreYouSureDialog';\nimport Form from './Form';\nimport * as ROUTES from '../routes';\nimport axios from '../common/shared';\nconst useStyles = makeStyles(theme => ({\n  container: {\n    height: '100vh',\n    display: 'flex',\n    flexDirection: 'column',\n    overflow: 'hidden'\n  },\n  content: {\n    position: 'relative',\n    flexGrow: 1,\n    display: 'flex'\n  },\n  list: {\n    maxHeight: '100vh',\n    overflow: 'auto',\n    flexBasis: 350,\n    flexShrink: 0,\n    background: theme.palette.background.paper\n  },\n  listItem: {\n    boxSizing: 'border-box',\n    maxWidth: 350,\n    paddingTop: 2,\n    paddingBottom: 2,\n    paddingRight: theme.spacing(2),\n    display: 'flex',\n    alignItems: 'center',\n    cursor: 'pointer',\n    overflow: 'hidden'\n  },\n  selected: {\n    paddingRight: theme.spacing(2) - 3,\n    borderRight: `3px solid ${theme.palette.secondary.main}`,\n    color: theme.palette.secondary.main\n  },\n  listSecondary: {\n    paddingRight: 0,\n    overflow: 'hidden'\n  },\n  listItemText: {\n    '& > .MuiListItemText-primary': {\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis'\n    }\n  },\n  listItemIcons: {\n    flexShrink: 0,\n    position: 'static',\n    transform: 'none',\n    display: 'flex',\n    '& > .MuiButtonBase-root': {\n      height: 'fit-content'\n    }\n  },\n  addButton: {\n    position: 'absolute',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2)\n  },\n  buttonContainer: {\n    display: 'flex',\n    flexDirection: 'row'\n  }\n}));\nlet storyCount = 0;\n\nconst App = () => {\n  const [stories, setStories] = useState([]);\n  const [selected, setSelected] = useState(undefined);\n  const [toDelete, setToDelete] = useState(false);\n  const [dontAskAgain, setDontAskAgain] = useState(false);\n  const classes = useStyles();\n  useEffect(() => {\n    const fetchStories = async () => {\n      const res = await axios.get(`stories/list`);\n      const stories = res.data.payload;\n      setStories(stories);\n      setSelected(stories[0]);\n    };\n\n    fetchStories();\n  }, []);\n\n  const handleChange = async (key, value) => {\n    const update = { ...selected,\n      [key]: value\n    };\n    setSelected(update);\n    setStories(stories => stories.map(story => story.uuid === update.uuid ? update : story));\n\n    if (key !== 'title' && key !== 'description') {\n      saveChanges(update);\n    }\n  };\n\n  const saveChanges = async update => {\n    try {\n      await axios.patch(`stories/${update.uuid}`, update);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const addStory = async () => {\n    const newStory = {\n      title: `Story ${++storyCount}`,\n      description: '',\n      targets: [],\n      modes: [],\n      accessible: false,\n      nodes: []\n    };\n\n    try {\n      const res = await axios.put('stories/', {\n        story: newStory\n      });\n      const withUuid = { ...newStory,\n        uuid: res.data.uuid\n      };\n      setStories(stories => [withUuid, ...stories]);\n      setSelected(withUuid);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const duplicateStory = async story => {\n    const duplicate = { ...story,\n      uuid: null,\n      title: `${story.title} Copy`\n    };\n\n    try {\n      const res = await axios.put('stories', {\n        story: duplicate\n      });\n      setStories(stories => [...stories, { ...duplicate,\n        uuid: res.data.uuid\n      }]);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const executeDeleteStory = async toDelete => {\n    try {\n      await axios.delete(`stories/${toDelete.uuid}`);\n      setStories(stories => stories.filter(story => story.uuid !== toDelete.uuid));\n\n      if (selected && selected.uuid === toDelete.uuid) {\n        setSelected(undefined);\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.content,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.list,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(List, {\n    dense: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 11\n    }\n  }, stories.map((story, index) => /*#__PURE__*/React.createElement(React.Fragment, {\n    key: story.uuid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ListItem, {\n    classes: {\n      container: `${classes.listItem} ${selected && selected.uuid === story.uuid ? classes.selected : ''}`,\n      secondaryAction: classes.listSecondary,\n      selected: classes.selected\n    },\n    onClick: () => setSelected(story),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(ListItemText, {\n    className: classes.listItemText,\n    primary: story.title,\n    primaryTypographyProps: {\n      variant: 'subtitle1'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(ListItemSecondaryAction, {\n    className: classes.listItemIcons,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Tooltip, {\n    title: \"Duplicate\",\n    placement: \"top-end\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    onClick: () => duplicateStory(story),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(FileCopyIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 25\n    }\n  }))), /*#__PURE__*/React.createElement(Tooltip, {\n    title: \"Delete\",\n    placement: \"top\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    onClick: () => dontAskAgain ? executeDeleteStory(story) : setToDelete(story),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(DeleteIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 25\n    }\n  }))), /*#__PURE__*/React.createElement(Tooltip, {\n    title: \"Edit in Editor\",\n    placement: \"top-start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    component: Link,\n    to: `${ROUTES.EDITOR}?storyId=${story.uuid}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(EditIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 25\n    }\n  }))), /*#__PURE__*/React.createElement(Tooltip, {\n    title: \"See in Evaluator\",\n    placement: \"top-start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    component: Link,\n    to: `${ROUTES.EVALUATOR}?storyId=${story.uuid}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(AssessmentIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 25\n    }\n  }))))), index !== stories.length - 1 && /*#__PURE__*/React.createElement(Divider, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 50\n    }\n  }))))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.content,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 9\n    }\n  }, selected && /*#__PURE__*/React.createElement(Form, {\n    story: selected,\n    handleChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 24\n    }\n  }))), /*#__PURE__*/React.createElement(Fab, {\n    color: \"primary\",\n    className: classes.addButton,\n    onClick: addStory,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(AddIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 9\n    }\n  })), !dontAskAgain && /*#__PURE__*/React.createElement(AreYouSureDialog, {\n    open: !!toDelete,\n    onCancel: () => setToDelete(null),\n    onConfirm: dontAskAgain => {\n      setDontAskAgain(dontAskAgain);\n      executeDeleteStory(toDelete);\n      setToDelete(null);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default App;","map":{"version":3,"sources":["/home/hmny/Projects/M-and-M/client/src/Publisher/index.js"],"names":["React","useEffect","useState","makeStyles","List","ListItem","ListItemText","ListItemSecondaryAction","IconButton","Divider","Fab","Tooltip","Add","AddIcon","Edit","EditIcon","Delete","DeleteIcon","FileCopy","FileCopyIcon","Assessment","AssessmentIcon","Link","AreYouSureDialog","Form","ROUTES","axios","useStyles","theme","container","height","display","flexDirection","overflow","content","position","flexGrow","list","maxHeight","flexBasis","flexShrink","background","palette","paper","listItem","boxSizing","maxWidth","paddingTop","paddingBottom","paddingRight","spacing","alignItems","cursor","selected","borderRight","secondary","main","color","listSecondary","listItemText","whiteSpace","textOverflow","listItemIcons","transform","addButton","bottom","left","buttonContainer","storyCount","App","stories","setStories","setSelected","undefined","toDelete","setToDelete","dontAskAgain","setDontAskAgain","classes","fetchStories","res","get","data","payload","handleChange","key","value","update","map","story","uuid","saveChanges","patch","err","console","error","addStory","newStory","title","description","targets","modes","accessible","nodes","put","withUuid","duplicateStory","duplicate","executeDeleteStory","delete","filter","index","secondaryAction","variant","EDITOR","EVALUATOR","length"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n  makeStyles,\n  List,\n  ListItem,\n  ListItemText,\n  ListItemSecondaryAction,\n  IconButton,\n  Divider,\n  Fab,\n  Tooltip,\n} from '@material-ui/core';\nimport {\n  Add as AddIcon,\n  Edit as EditIcon,\n  Delete as DeleteIcon,\n  FileCopy as FileCopyIcon,\n  Assessment as AssessmentIcon,\n} from '@material-ui/icons';\nimport { Link } from 'react-router-dom';\n\nimport AreYouSureDialog from './AreYouSureDialog';\nimport Form from './Form';\nimport * as ROUTES from '../routes';\nimport axios from '../common/shared';\n\nconst useStyles = makeStyles(theme => ({\n  container: {\n    height: '100vh',\n    display: 'flex',\n    flexDirection: 'column',\n    overflow: 'hidden',\n  },\n  content: {\n    position: 'relative',\n    flexGrow: 1,\n    display: 'flex',\n  },\n  list: {\n    maxHeight: '100vh',\n    overflow: 'auto',\n    flexBasis: 350,\n    flexShrink: 0,\n    background: theme.palette.background.paper,\n  },\n  listItem: {\n    boxSizing: 'border-box',\n    maxWidth: 350,\n    paddingTop: 2,\n    paddingBottom: 2,\n    paddingRight: theme.spacing(2),\n    display: 'flex',\n    alignItems: 'center',\n    cursor: 'pointer',\n    overflow: 'hidden',\n  },\n  selected: {\n    paddingRight: theme.spacing(2) - 3,\n    borderRight: `3px solid ${theme.palette.secondary.main}`,\n    color: theme.palette.secondary.main,\n  },\n  listSecondary: {\n    paddingRight: 0,\n    overflow: 'hidden',\n  },\n  listItemText: {\n    '& > .MuiListItemText-primary': {\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n    },\n  },\n  listItemIcons: {\n    flexShrink: 0,\n    position: 'static',\n    transform: 'none',\n    display: 'flex',\n    '& > .MuiButtonBase-root': {\n      height: 'fit-content',\n    },\n  },\n  addButton: {\n    position: 'absolute',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2),\n  },\n  buttonContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n  },\n}));\n\nlet storyCount = 0;\n\nconst App = () => {\n  const [stories, setStories] = useState([]);\n  const [selected, setSelected] = useState(undefined);\n  const [toDelete, setToDelete] = useState(false);\n  const [dontAskAgain, setDontAskAgain] = useState(false);\n\n  const classes = useStyles();\n\n  useEffect(() => {\n    const fetchStories = async () => {\n      const res = await axios.get(`stories/list`);\n      const stories = res.data.payload;\n      setStories(stories);\n      setSelected(stories[0]);\n    };\n\n    fetchStories();\n  }, []);\n\n  const handleChange = async (key, value) => {\n    const update = { ...selected, [key]: value };\n    setSelected(update);\n    setStories(stories =>\n      stories.map(story => (story.uuid === update.uuid ? update : story))\n    );\n\n    if (key !== 'title' && key !== 'description') {\n      saveChanges(update);\n    }\n  };\n  const saveChanges = async update => {\n    try {\n      await axios.patch(`stories/${update.uuid}`, update);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const addStory = async () => {\n    const newStory = {\n      title: `Story ${++storyCount}`,\n      description: '',\n      targets: [],\n      modes: [],\n      accessible: false,\n      nodes: [],\n    };\n\n    try {\n      const res = await axios.put('stories/', { story: newStory });\n      const withUuid = { ...newStory, uuid: res.data.uuid };\n      setStories(stories => [withUuid, ...stories]);\n      setSelected(withUuid);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const duplicateStory = async story => {\n    const duplicate = {\n      ...story,\n      uuid: null,\n      title: `${story.title} Copy`,\n    };\n\n    try {\n      const res = await axios.put('stories', { story: duplicate });\n      setStories(stories => [...stories, { ...duplicate, uuid: res.data.uuid }]);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  const executeDeleteStory = async toDelete => {\n    try {\n      await axios.delete(`stories/${toDelete.uuid}`);\n      setStories(stories => stories.filter(story => story.uuid !== toDelete.uuid));\n      if (selected && selected.uuid === toDelete.uuid) {\n        setSelected(undefined);\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  return (\n    <div className={classes.container}>\n      <div className={classes.content}>\n        <div className={classes.list}>\n          <List dense>\n            {stories.map((story, index) => (\n              <React.Fragment key={story.uuid}>\n                <ListItem\n                  classes={{\n                    container: `${classes.listItem} ${\n                      selected && selected.uuid === story.uuid ? classes.selected : ''\n                    }`,\n                    secondaryAction: classes.listSecondary,\n                    selected: classes.selected,\n                  }}\n                  onClick={() => setSelected(story)}\n                >\n                  <ListItemText\n                    className={classes.listItemText}\n                    primary={story.title}\n                    primaryTypographyProps={{ variant: 'subtitle1' }}\n                  />\n                  <ListItemSecondaryAction className={classes.listItemIcons}>\n                    <Tooltip title=\"Duplicate\" placement=\"top-end\">\n                      <IconButton onClick={() => duplicateStory(story)}>\n                        <FileCopyIcon />\n                      </IconButton>\n                    </Tooltip>\n                    <Tooltip title=\"Delete\" placement=\"top\">\n                      <IconButton\n                        onClick={() =>\n                          dontAskAgain ? executeDeleteStory(story) : setToDelete(story)\n                        }\n                      >\n                        <DeleteIcon />\n                      </IconButton>\n                    </Tooltip>\n                    <Tooltip title=\"Edit in Editor\" placement=\"top-start\">\n                      <IconButton\n                        component={Link}\n                        to={`${ROUTES.EDITOR}?storyId=${story.uuid}`}\n                      >\n                        <EditIcon />\n                      </IconButton>\n                    </Tooltip>\n                    <Tooltip title=\"See in Evaluator\" placement=\"top-start\">\n                      <IconButton\n                        component={Link}\n                        to={`${ROUTES.EVALUATOR}?storyId=${story.uuid}`}\n                      >\n                        <AssessmentIcon />\n                      </IconButton>\n                    </Tooltip>\n                  </ListItemSecondaryAction>\n                </ListItem>\n                {index !== stories.length - 1 && <Divider />}\n              </React.Fragment>\n            ))}\n          </List>\n        </div>\n        <div className={classes.content}>\n          {selected && <Form story={selected} handleChange={handleChange} />}\n        </div>\n      </div>\n      <Fab color=\"primary\" className={classes.addButton} onClick={addStory}>\n        <AddIcon />\n      </Fab>\n      {!dontAskAgain && (\n        <AreYouSureDialog\n          open={!!toDelete}\n          onCancel={() => setToDelete(null)}\n          onConfirm={dontAskAgain => {\n            setDontAskAgain(dontAskAgain);\n            executeDeleteStory(toDelete);\n            setToDelete(null);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}