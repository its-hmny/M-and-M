{"ast":null,"code":"var _jsxFileName = \"/home/hmny/Projects/M-and-M/client/src/Editor/components/EditorFragments/AnswerFragment.js\";\nimport React, { useState, useEffect } from 'react';\nimport { makeStyles, Button, IconButton, Divider, MenuItem, Select, FormControl, InputLabel, TextField } from '@material-ui/core';\nimport { useEditor } from '../../context/EditorContext';\nimport CheckboxFragment from './CheckboxFragment';\nimport RadioFragment from './RadioFragment';\nimport shortid from 'shortid';\nimport DeleteIcon from '@material-ui/icons/Delete';\nconst useStyles = makeStyles(theme => ({\n  root: {\n    overflow: 'auto'\n  },\n  inputRoot: {\n    paddingRight: theme.spacing(2)\n  },\n  divider: {\n    marginTop: theme.spacing(2)\n  },\n  FormSelect: {\n    marginTop: theme.spacing(2)\n  },\n  deleteStyle: {\n    marginTop: theme.spacing(1)\n  }\n}));\nconst ANSWER_VALUE = {\n  CORRECT: '[CORRECT]',\n  WRONG: '[WRONG]'\n};\n\nconst AnswerFragment = ({\n  classNames,\n  path,\n  fragmentSpecificProps\n}) => {\n  const {\n    divider,\n    FormSelect,\n    deleteStyle\n  } = useStyles();\n  const {\n    story,\n    getFromPath,\n    setPathToValue\n  } = useEditor();\n  const {\n    valToChange,\n    singleCorrectAnswer,\n    selectPath,\n    correctStory,\n    wrongStory,\n    data,\n    dataName,\n    correctLabel,\n    wrongLabel\n  } = fragmentSpecificProps;\n  const [correctAnswerValue, setCorrectAnswerValue] = useState([]); //Additional field to modify objects or array\n\n  path = path || [];\n  const answers = getFromPath(path)[valToChange];\n  const pointsPath = path.concat(valToChange);\n  const selectCompletePath = path.concat(selectPath);\n  const correctSelectValue = getFromPath(selectCompletePath)[correctStory];\n  const wrongSelectValue = getFromPath(selectCompletePath)[wrongStory];\n  const items = [];\n  const menuItems = story.nodes.map(node => {\n    if (!items.includes(node[data])) {\n      items.push(node[data]);\n      return /*#__PURE__*/React.createElement(MenuItem, {\n        key: node[data],\n        value: node[data],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 9\n        }\n      }, node[dataName]);\n    }\n\n    return null;\n  }); //Initialize correctAnswerValue if singleCorrectAnswer == true only the first time\n\n  useEffect(() => {\n    if (singleCorrectAnswer) {\n      answers.map((answer, i) => answer.value === ANSWER_VALUE.CORRECT ? setCorrectAnswerValue(i) : null);\n    }\n  }, [singleCorrectAnswer, answers]);\n\n  const addChoice = () => {\n    setPathToValue(path, 'answers', [...answers, {\n      value: ANSWER_VALUE.WRONG,\n      id: shortid.generate(),\n      text: 'Risposta'\n    }]);\n  };\n\n  const deleteChoice = i => {\n    answers.splice(i, 1);\n    setPathToValue(path, 'answers', answers);\n  };\n\n  const cannotChooseCorrectAnswer = singleCorrectAnswer ? answers.filter(answer => answer.value === ANSWER_VALUE.CORRECT).length === 1 : false;\n  const name = shortid.generate();\n\n  const checkSingleAnswer = (event, value, answerPath, truthValues) => {\n    const oldAnswerPath = [...answerPath.slice(0, -1), correctAnswerValue];\n    setPathToValue(oldAnswerPath, 'value', truthValues !== undefined ? truthValues[1] : false);\n    setCorrectAnswerValue(value);\n    setPathToValue(answerPath, 'value', event.target.checked ? truthValues !== undefined ? truthValues[0] : true : truthValues !== undefined ? truthValues[1] : false);\n  };\n\n  const setNumberField = (value, index) => {\n    const parsed = parseInt(value);\n    const newVal = answers[index];\n\n    if (!isNaN(parsed)) {\n      newVal.points = parsed;\n    } else if (value === '' || value === '-') {\n      newVal.points = value;\n    } else {\n      newVal.points = 0;\n    }\n\n    setPathToValue(pointsPath, index, newVal);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames.InspectorElement,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    color: \"primary\",\n    variant: \"contained\",\n    onClick: addChoice,\n    className: classNames.InspectorElement,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }\n  }, \"Add\"), answers.map((answer, i) => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: `answer-${i}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Divider, {\n      className: divider,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        display: 'flex',\n        alignItems: 'bottom'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(TextField, {\n      value: answers[i].text,\n      className: classNames.InspectorElement,\n      label: 'Answer text',\n      onChange: event => setPathToValue(path.concat('answers', i) || [], 'text', event.target.value),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(IconButton, {\n      onClick: () => deleteChoice(i),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(DeleteIcon, {\n      className: deleteStyle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 17\n      }\n    }))), /*#__PURE__*/React.createElement(TextField, {\n      label: 'Answer points',\n      value: answer.points,\n      className: classNames.InspectorElement,\n      onChange: event => setNumberField(event.target.value, i),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 13\n      }\n    }), singleCorrectAnswer ? /*#__PURE__*/React.createElement(RadioFragment, {\n      classNames: classNames,\n      path: path,\n      fragmentSpecificProps: {\n        label: 'Correct Answer',\n        pathAlternative: ['answers', i],\n        valToChange: 'value',\n        onChange: checkSingleAnswer,\n        truthValues: [ANSWER_VALUE.CORRECT, ANSWER_VALUE.WRONG],\n        name: name,\n        correctAnswerValue: correctAnswerValue,\n        index: i\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 15\n      }\n    }) : /*#__PURE__*/React.createElement(CheckboxFragment, {\n      classNames: classNames,\n      path: path,\n      fragmentSpecificProps: {\n        label: 'Correct Answer',\n        pathAlternative: ['answers', i],\n        valToChange: 'value',\n        truthValues: [ANSWER_VALUE.CORRECT, ANSWER_VALUE.WRONG],\n        disabled: answer.value === ANSWER_VALUE.CORRECT ? false : cannotChooseCorrectAnswer\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 15\n      }\n    }));\n  }), /*#__PURE__*/React.createElement(Divider, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(FormControl, {\n    className: `${classNames.FormControl} ${FormSelect} ${classNames.InspectorElement}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 9\n    }\n  }, correctLabel), /*#__PURE__*/React.createElement(Select, {\n    value: correctSelectValue,\n    onChange: event => setPathToValue(selectCompletePath, correctStory, event.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 9\n    }\n  }, menuItems)), /*#__PURE__*/React.createElement(FormControl, {\n    className: `${classNames.FormControl} ${FormSelect} ${classNames.InspectorElement}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 9\n    }\n  }, wrongLabel), /*#__PURE__*/React.createElement(Select, {\n    value: wrongSelectValue,\n    onChange: event => setPathToValue(selectCompletePath, wrongStory, event.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 9\n    }\n  }, menuItems)));\n};\n\nexport default AnswerFragment;","map":{"version":3,"sources":["/home/hmny/Projects/M-and-M/client/src/Editor/components/EditorFragments/AnswerFragment.js"],"names":["React","useState","useEffect","makeStyles","Button","IconButton","Divider","MenuItem","Select","FormControl","InputLabel","TextField","useEditor","CheckboxFragment","RadioFragment","shortid","DeleteIcon","useStyles","theme","root","overflow","inputRoot","paddingRight","spacing","divider","marginTop","FormSelect","deleteStyle","ANSWER_VALUE","CORRECT","WRONG","AnswerFragment","classNames","path","fragmentSpecificProps","story","getFromPath","setPathToValue","valToChange","singleCorrectAnswer","selectPath","correctStory","wrongStory","data","dataName","correctLabel","wrongLabel","correctAnswerValue","setCorrectAnswerValue","answers","pointsPath","concat","selectCompletePath","correctSelectValue","wrongSelectValue","items","menuItems","nodes","map","node","includes","push","answer","i","value","addChoice","id","generate","text","deleteChoice","splice","cannotChooseCorrectAnswer","filter","length","name","checkSingleAnswer","event","answerPath","truthValues","oldAnswerPath","slice","undefined","target","checked","setNumberField","index","parsed","parseInt","newVal","isNaN","points","InspectorElement","display","alignItems","label","pathAlternative","onChange","disabled"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport {\n  makeStyles,\n  Button,\n  IconButton,\n  Divider,\n  MenuItem,\n  Select,\n  FormControl,\n  InputLabel,\n  TextField,\n} from '@material-ui/core';\nimport { useEditor } from '../../context/EditorContext';\nimport CheckboxFragment from './CheckboxFragment';\nimport RadioFragment from './RadioFragment';\nimport shortid from 'shortid';\nimport DeleteIcon from '@material-ui/icons/Delete';\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    overflow: 'auto',\n  },\n  inputRoot: {\n    paddingRight: theme.spacing(2),\n  },\n  divider: {\n    marginTop: theme.spacing(2),\n  },\n  FormSelect: {\n    marginTop: theme.spacing(2),\n  },\n  deleteStyle: {\n    marginTop: theme.spacing(1),\n  },\n}));\nconst ANSWER_VALUE = {\n  CORRECT: '[CORRECT]',\n  WRONG: '[WRONG]',\n};\nconst AnswerFragment = ({ classNames, path, fragmentSpecificProps }) => {\n  const { divider, FormSelect, deleteStyle } = useStyles();\n  const { story, getFromPath, setPathToValue } = useEditor();\n  const {\n    valToChange,\n    singleCorrectAnswer,\n    selectPath,\n    correctStory,\n    wrongStory,\n    data,\n    dataName,\n    correctLabel,\n    wrongLabel,\n  } = fragmentSpecificProps;\n  const [correctAnswerValue, setCorrectAnswerValue] = useState([]);\n\n  //Additional field to modify objects or array\n  path = path || [];\n  const answers = getFromPath(path)[valToChange];\n  const pointsPath = path.concat(valToChange);\n  const selectCompletePath = path.concat(selectPath);\n  const correctSelectValue = getFromPath(selectCompletePath)[correctStory];\n  const wrongSelectValue = getFromPath(selectCompletePath)[wrongStory];\n\n  const items = [];\n  const menuItems = story.nodes.map(node => {\n    if (!items.includes(node[data])) {\n      items.push(node[data]);\n      return (\n        <MenuItem key={node[data]} value={node[data]}>\n          {node[dataName]}\n        </MenuItem>\n      );\n    }\n\n    return null;\n  });\n\n  //Initialize correctAnswerValue if singleCorrectAnswer == true only the first time\n  useEffect(() => {\n    if (singleCorrectAnswer) {\n      answers.map((answer, i) =>\n        answer.value === ANSWER_VALUE.CORRECT ? setCorrectAnswerValue(i) : null\n      );\n    }\n  }, [singleCorrectAnswer, answers]);\n\n  const addChoice = () => {\n    setPathToValue(path, 'answers', [\n      ...answers,\n      { value: ANSWER_VALUE.WRONG, id: shortid.generate(), text: 'Risposta' },\n    ]);\n  };\n  const deleteChoice = i => {\n    answers.splice(i, 1);\n    setPathToValue(path, 'answers', answers);\n  };\n\n  const cannotChooseCorrectAnswer = singleCorrectAnswer\n    ? answers.filter(answer => answer.value === ANSWER_VALUE.CORRECT).length === 1\n    : false;\n  const name = shortid.generate();\n\n  const checkSingleAnswer = (event, value, answerPath, truthValues) => {\n    const oldAnswerPath = [...answerPath.slice(0, -1), correctAnswerValue];\n    setPathToValue(\n      oldAnswerPath,\n      'value',\n      truthValues !== undefined ? truthValues[1] : false\n    );\n    setCorrectAnswerValue(value);\n    setPathToValue(\n      answerPath,\n      'value',\n      event.target.checked\n        ? truthValues !== undefined\n          ? truthValues[0]\n          : true\n        : truthValues !== undefined\n        ? truthValues[1]\n        : false\n    );\n  };\n\n  const setNumberField = (value, index) => {\n    const parsed = parseInt(value);\n\n    const newVal = answers[index];\n    if (!isNaN(parsed)) {\n      newVal.points = parsed;\n    } else if (value === '' || value === '-') {\n      newVal.points = value;\n    } else {\n      newVal.points = 0;\n    }\n\n    setPathToValue(pointsPath, index, newVal);\n  };\n\n  return (\n    <div className={classNames.InspectorElement}>\n      <Button\n        color=\"primary\"\n        variant=\"contained\"\n        onClick={addChoice}\n        className={classNames.InspectorElement}\n      >\n        Add\n      </Button>\n      {answers.map((answer, i) => {\n        return (\n          <div key={`answer-${i}`}>\n            <Divider className={divider} />\n            <div style={{ display: 'flex', alignItems: 'bottom' }}>\n              <TextField\n                value={answers[i].text}\n                className={classNames.InspectorElement}\n                label={'Answer text'}\n                onChange={event =>\n                  setPathToValue(\n                    path.concat('answers', i) || [],\n                    'text',\n                    event.target.value\n                  )\n                }\n              />\n              <IconButton onClick={() => deleteChoice(i)}>\n                <DeleteIcon className={deleteStyle}></DeleteIcon>\n              </IconButton>\n            </div>\n            <TextField\n              label={'Answer points'}\n              value={answer.points}\n              className={classNames.InspectorElement}\n              onChange={event => setNumberField(event.target.value, i)}\n            />\n            {singleCorrectAnswer ? (\n              <RadioFragment\n                classNames={classNames}\n                path={path}\n                fragmentSpecificProps={{\n                  label: 'Correct Answer',\n                  pathAlternative: ['answers', i],\n                  valToChange: 'value',\n                  onChange: checkSingleAnswer,\n                  truthValues: [ANSWER_VALUE.CORRECT, ANSWER_VALUE.WRONG],\n                  name: name,\n                  correctAnswerValue: correctAnswerValue,\n                  index: i,\n                }}\n              />\n            ) : (\n              <CheckboxFragment\n                classNames={classNames}\n                path={path}\n                fragmentSpecificProps={{\n                  label: 'Correct Answer',\n                  pathAlternative: ['answers', i],\n                  valToChange: 'value',\n                  truthValues: [ANSWER_VALUE.CORRECT, ANSWER_VALUE.WRONG],\n                  disabled:\n                    answer.value === ANSWER_VALUE.CORRECT\n                      ? false\n                      : cannotChooseCorrectAnswer,\n                }}\n              />\n            )}\n          </div>\n        );\n      })}\n      <Divider />\n      <FormControl\n        className={`${classNames.FormControl} ${FormSelect} ${classNames.InspectorElement}`}\n      >\n        <InputLabel>{correctLabel}</InputLabel>\n        <Select\n          value={correctSelectValue}\n          onChange={event =>\n            setPathToValue(selectCompletePath, correctStory, event.target.value)\n          }\n        >\n          {menuItems}\n        </Select>\n      </FormControl>\n\n      <FormControl\n        className={`${classNames.FormControl} ${FormSelect} ${classNames.InspectorElement}`}\n      >\n        <InputLabel>{wrongLabel}</InputLabel>\n        <Select\n          value={wrongSelectValue}\n          onChange={event =>\n            setPathToValue(selectCompletePath, wrongStory, event.target.value)\n          }\n        >\n          {menuItems}\n        </Select>\n      </FormControl>\n    </div>\n  );\n};\n\nexport default AnswerFragment;\n"]},"metadata":{},"sourceType":"module"}